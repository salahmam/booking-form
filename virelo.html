// تغيير الخلفية
const bgButtons = document.querySelectorAll(".bg-btn");
const body = document.body;

bgButtons.forEach((btn) => {
  btn.addEventListener("click", () => {
    bgButtons.forEach((b) => b.classList.remove("active"));
    btn.classList.add("active");

    const bg = btn.dataset.bg;
    body.classList.remove("bg-white", "bg-black", "bg-transparent");
    if (bg === "white") body.classList.add("bg-white");
    if (bg === "black") body.classList.add("bg-black");
    if (bg === "transparent") body.classList.add("bg-transparent");
  });
});

// تحميل الشعار كـ PNG
const downloadBtn = document.getElementById("download-btn");
const logoSvg = document.getElementById("logo-svg");

downloadBtn.addEventListener("click", () => {
  const serializer = new XMLSerializer();
  const svgString = serializer.serializeToString(logoSvg);

  const svgBlob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
  const url = URL.createObjectURL(svgBlob);

  const img = new Image();
  img.onload = () => {
    const scale = 3; // دقة عالية
    const width = logoSvg.viewBox.baseVal.width * scale;
    const height = logoSvg.viewBox.baseVal.height * scale;

    const canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext("2d");

    // خلفية حسب الوضع الحالي
    if (body.classList.contains("bg-white")) {
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, width, height);
    } else if (body.classList.contains("bg-black")) {
      ctx.fillStyle = "#050607";
      ctx.fillRect(0, 0, width, height);
    }
    // إذا شفافة لا نرسم خلفية

    ctx.drawImage(img, 0, 0, width, height);

    canvas.toBlob((blob) => {
      const pngUrl = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = pngUrl;
      a.download = "VIRELO-logo.png";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(pngUrl);
      URL.revokeObjectURL(url);
    }, "image/png");
  };

  img.onerror = () => {
    alert("حدث خطأ أثناء توليد الصورة، جرّب تحديث الصفحة.");
  };

  img.src = url;
});