from pathlib import Path

# إعادة تحميل الملف الأصلي بعد reset
original_path = Path("/mnt/data/sudoku_yalla_levels.html")
content = original_path.read_text(encoding="utf-8")

# التعديلات:
content = content.replace(
    '<label for="stage">المستوى:</label>\n        <select id="stage" aria-label="اختيار المستوى"></select>',
    '''<label for="levelSel">المستوى:</label>
        <select id="levelSel" aria-label="اختيار المستوى"></select>
        <label for="stageSel">المرحلة:</label>
        <select id="stageSel" aria-label="اختيار المرحلة"></select>'''
)

content = content.replace(
    'div.dataset.editable = "true";',
    'div.dataset.editable = "true";\n          div.setAttribute("inputmode","numeric");\n          div.setAttribute("pattern","[0-9]*");'
)

extra_js = """
    let currentLevel = 1;

    function buildSelectors(){
      // بناء قائمة المستويات (6 مستويات)
      const levelSel = document.getElementById("levelSel");
      levelSel.innerHTML = "";
      for(let i=1;i<=6;i++){
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `المستوى ${i}`;
        levelSel.appendChild(opt);
      }
      // بناء قائمة المراحل (10 مراحل)
      const stageSel = document.getElementById("stageSel");
      stageSel.innerHTML = "";
      for(let j=1;j<=10;j++){
        const opt2 = document.createElement("option");
        opt2.value = j;
        opt2.textContent = `المرحلة ${j}`;
        stageSel.appendChild(opt2);
      }
      levelSel.value = currentLevel;
      stageSel.value = currentStage;
    }

    function newGame(level, stage){
      currentLevel = level;
      currentStage = stage;
      buildSelectors();
      status(`تحميل المستوى ${level} — المرحلة ${stage}...`);
      SIDE = 3+level; // المستوى1=4x4 ... المستوى6=9x9
      BOX = Math.floor(Math.sqrt(SIDE));
      const full = generateFull();
      solutionBoard = full;
      const blanks = blanksFor(stage);
      initialBoard = removeCells(full, blanks);
      buildBoard(initialBoard);
    }
"""
content = content.replace(
    "// Init",
    extra_js + "\n    // Init"
)

content = content.replace(
    "newStage(1);",
    "newGame(1,1);"
)

# حفظ الملف المعدل
new_path = Path("/mnt/data/sudoku_yalla_levels_fixed.html")
new_path.write_text(content, encoding="utf-8")

new_path