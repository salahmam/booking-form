<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>سودوكو — مستويات متدرجة (ألوان يلا لودو)</title>
<style>
:root{
  --bg:#0f0f12;--card:#181a1f;--ink:#e9eef6;--muted:#aeb7c8;--accent:#00d8ff;
  --red:#ea3b2d;--blue:#2f7bff;--green:#27c93f;--yellow:#ffcc00;
  --cell:#1f232b;--cell-focus:#263043;--cell-border:#2f3644;
  --ok:#2bd576;--bad:#ff5d5d;--btn:#202735;--btn-hover:#2a3446;
}
*{box-sizing:border-box}
body{
  margin:0;background:
  radial-gradient(1200px 600px at 10% -10%, rgba(255,0,0,.2), transparent 60%),
  radial-gradient(1200px 600px at 110% 10%, rgba(0,255,0,.15), transparent 60%),
  radial-gradient(1200px 600px at -10% 100%, rgba(0,0,255,.18), transparent 60%),
  radial-gradient(1200px 600px at 120% 120%, rgba(255,215,0,.18), transparent 60%),
  var(--bg);
  color:var(--ink);
  font-family:"Tajawal","Cairo","Noto Kufi Arabic",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  min-height:100dvh;display:grid;grid-template-rows:auto 1fr auto;gap:14px;
}
header{display:flex;justify-content:center;align-items:center;padding:16px 12px;position:sticky;top:0;backdrop-filter:blur(8px)}
.wrap{width:min(1100px,92vw);margin:0 auto}
.title{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap}
.badge{padding:6px 10px;font-weight:700;border-radius:10px;background:linear-gradient(135deg,var(--green),var(--yellow));color:#102312;box-shadow:0 6px 16px rgba(39,201,63,.32)}
h1{margin:0;font-weight:800;letter-spacing:.3px;text-shadow:0 6px 30px rgba(0,0,0,.35)}
.hud{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;margin-top:14px}
.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
select,button,input.cell{
  background:var(--btn);border:1px solid var(--cell-border);color:var(--ink);
  padding:10px 14px;border-radius:12px;font-size:16px;cursor:pointer;
  transition:transform .12s ease,background .2s ease,box-shadow .2s ease;
  box-shadow:0 6px 20px rgba(0,0,0,.25)
}
button:hover,select:hover{background:var(--btn-hover)}
button:active{transform:translateY(1px) scale(.99)}
.pill{padding:10px 14px;border-radius:999px;border:1px dashed var(--cell-border);color:var(--muted);font-weight:600;background:#161a21}
.game{display:grid;grid-template-columns:1fr;justify-items:center;gap:18px;margin:8px 0 26px}
.board{
  width:min(92vw,530px);aspect-ratio:1/1;background:linear-gradient(180deg,#151821,#10131a);
  border-radius:18px;padding:12px;box-shadow:0 12px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.03);
  display:grid;grid-template-columns:repeat(9,1fr);grid-template-rows:repeat(9,1fr);gap:2px;position:relative;overflow:hidden
}
.cell{
  display:grid;place-items:center;font-size:clamp(18px,3.2vw,26px);font-weight:800;background:var(--cell);
  border:1px solid var(--cell-border);border-radius:9px;transition:background .15s ease,transform .07s ease,box-shadow .2s ease;
  outline:none;user-select:none;text-align:center;caret-color:transparent
}
input.cell{caret-color:auto;-moz-appearance:textfield}
input.cell::-webkit-outer-spin-button,input.cell::-webkit-inner-spin-button{ -webkit-appearance:none;margin:0 }
.cell[data-editable="true"]{background:#1b2130;cursor:pointer}
.cell:focus-visible{outline:2px solid var(--accent);box-shadow:0 0 0 6px rgba(0,216,255,.08)}
.cell[data-selected="true"]{background:var(--cell-focus);transform:scale(1.02)}
/* خطوط سميكة لمربعات 3×3 الافتراضية (سيتم ضبطها بالحجم) */
.cell[data-r="2"],.cell[data-r="5"]{border-bottom:2px solid var(--ink)}
.cell[data-c="2"],.cell[data-c="5"]{border-right:2px solid var(--ink)}
/* ألوان صناديق */
.cell[data-box="0"],.cell[data-box="8"]{background-image:linear-gradient(145deg, rgba(39,201,63,.10), rgba(39,201,63,.04))}
.cell[data-box="1"],.cell[data-box="7"]{background-image:linear-gradient(145deg, rgba(255,204,0,.10), rgba(255,204,0,.04))}
.cell[data-box="2"],.cell[data-box="6"]{background-image:linear-gradient(145deg, rgba(47,123,255,.12), rgba(47,123,255,.05))}
.cell[data-box="3"],.cell[data-box="5"]{background-image:linear-gradient(145deg, rgba(234,59,45,.12), rgba(234,59,45,.05))}
.cell[data-box="4"]{background-image:linear-gradient(145deg, rgba(0,216,255,.10), rgba(0,216,255,.04))}
.legend{display:grid;grid-template-columns:repeat(5,max-content);gap:8px 14px;align-items:center;justify-content:center}
.dot{width:12px;height:12px;border-radius:50%;display:inline-block;margin-inline-start:4px}
.red{background:var(--red)}.blue{background:var(--blue)}.green{background:var(--green)}.yellow{background:var(--yellow)}.aqua{background:var(--accent)}
.footer{color:var(--muted);text-align:center;padding:16px 10px 30px;font-size:14px}
@keyframes shake{10%{transform:translateX(-2px)}20%{transform:translateX(2px)}30%{transform:translateX(-2px)}40%{transform:translateX(2px)}50%{transform:translateX(-2px)}60%{transform:translateX(2px)}100%{transform:translateX(0)}}
.shake{animation:shake .35s linear both}
@keyframes pop{0%{transform:scale(.9)}100%{transform:scale(1)}}
.pop{animation:pop .12s ease-out}
.wrong{background:linear-gradient(180deg, rgba(255,93,93,.15), rgba(255,93,93,.05));border-color:rgba(255,93,93,.8)!important}
.correct{background:linear-gradient(180deg, rgba(43,213,118,.18), rgba(43,213,118,.07));border-color:rgba(43,213,118,.9)!important}
.toolbar{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn-cta{background:linear-gradient(135deg,var(--green),var(--yellow));color:#103313;border:none;font-weight:800;letter-spacing:.3px;box-shadow:0 10px 28px rgba(39,201,63,.35);padding:10px 14px;border-radius:12px;cursor:pointer}
.btn-cta:hover{filter:brightness(1.05)}
.btn-danger{background:linear-gradient(135deg,#ff6a6a,#ea3b2d);border:none;color:#fff;font-weight:800;box-shadow:0 10px 28px rgba(234,59,45,.35);padding:10px 14px;border-radius:12px;cursor:pointer}
.btn-secondary{background:linear-gradient(135deg,#2f7bff,#00d8ff);border:none;color:#041225;font-weight:800;box-shadow:0 10px 28px rgba(47,123,255,.35);padding:10px 14px;border-radius:12px;cursor:pointer}
.progress{height:10px;background:#11151b;border:1px solid var(--cell-border);border-radius:999px;overflow:hidden;box-shadow:inset 0 0 0 1px rgba(255,255,255,.03)}
.progress>div{height:100%;width:0%;background:linear-gradient(90deg,var(--blue),var(--accent));transition:width .3s ease}
.timer{text-align:center;font-weight:700;letter-spacing:.4px}
#confetti{position:absolute;inset:0;pointer-events:none}
@media (max-width:480px){.legend{grid-template-columns:repeat(3,max-content)}}
</style>

<!-- (اختياري) سكربت AdSense العام — فعّله بعد إضافة بيانات حسابك
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-xxxxxxxxxxxxxxxx" crossorigin="anonymous"></script>
-->
</head>
<body>
  <header>
    <div class="wrap title">
      <span class="badge">سودوكو</span>
      <h1>  🦋 صنع بحب ❤️ </h1>
    </div>
  </header>

  <main class="wrap">
    <div class="hud">
      <div class="controls">
        <label for="level">المستوى:</label>
        <select id="level" aria-label="اختيار المستوى"></select>
        <label for="stage">المرحلة:</label>
        <select id="stage" aria-label="اختيار المرحلة"></select>
        <span class="pill" id="status">جاهز</span>
      </div>

      <div class="timer" id="timer">00:00</div>

      <div class="controls" style="justify-content:flex-end;">
        <div style="min-width:180px;">
          <div class="progress" title="التقدّم">
            <div id="progressBar"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- إعلان جوجل فوق صندوق المربعات -->
    <div style="margin:10px 0;text-align:center">
      <ins class="adsbygoogle" 
           style="display:block" 
           data-ad-client="ca-pub-xxxxxxxxxxxxxxxx" 
           data-ad-slot="1234567890" 
           data-ad-format="auto"></ins>
      <script>(window.adsbygoogle=window.adsbygoogle||[]).push({});</script>
    </div>

    <section class="game">
      <div class="board" id="board" role="grid" aria-label="شبكة سودوكو">
        <canvas id="confetti"></canvas>
      </div>

      <div class="toolbar">
        <button class="btn-cta" id="btnCheck">تحقّق</button>
        <button class="btn-secondary" id="btnNext">التالي ⮕</button>
        <button class="btn-danger" id="btnReset">إعادة</button>
      </div>

      <div class="legend">
        <span><span class="dot green"></span> مربعات 3×3 ملوّنة</span>
        <span><span class="dot yellow"></span> خلية مبدئية</span>
        <span><span class="dot blue"></span> تحديد الخلية</span>
        <span><span class="dot aqua"></span> تلميحات الحالة</span>
        <span><span class="dot red"></span> أخطاء</span>
      </div>
    </section>

    <!-- إعلان جوجل أسفل الموقع قبل الفوتر -->
    <div style="margin:20px 0;text-align:center">
      <ins class="adsbygoogle" 
           style="display:block" 
           data-ad-client="ca-pub-xxxxxxxxxxxxxxxx" 
           data-ad-slot="1234567891" 
           data-ad-format="auto"></ins>
      <script>(window.adsbygoogle=window.adsbygoogle||[]).push({});</script>
    </div>

  </main>

  <footer class="footer">
    صنع بحب —  جميع الحقوق محفوظه لـ <b>SALAH ALKLEEFA</b>. الأرقام من 1 إلى 9 فقط. بالتوفيق! ✨
  </footer>

  <!-- أصوات -->
  <audio id="clickSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2561/2561-preview.mp3"></audio>
  <audio id="winSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>

<script>
/* ======= Helpers ======= */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const boardEl=$("#board"), levelSel=$("#level"), stageSel=$("#stage"), statusEl=$("#status");
const progressEl=$("#progressBar"), timerEl=$("#timer"), btnCheck=$("#btnCheck"), btnNext=$("#btnNext"), btnReset=$("#btnReset");
const confettiCanvas=$("#confetti"), ctx=confettiCanvas.getContext("2d");
const clickSound=$("#clickSound"), winSound=$("#winSound");
let SIDE=9, BOXR=3, BOXC=3, currentLevel=1, currentStage=1, initialBoard=[], startTime=null, timerInt=null;

/* ======= Time/Status/Progress ======= */
const pad=n=>n.toString().padStart(2,'0');
const fmt=sec=>`${pad(Math.floor(sec/60))}:${pad(sec%60)}`;
function startTimer(){ if(timerInt) clearInterval(timerInt); startTime=Date.now(); timerInt=setInterval(()=>{ timerEl.textContent=fmt(Math.floor((Date.now()-startTime)/1000)); },1000); }
function stopTimer(){ if(timerInt){ clearInterval(timerInt); timerInt=null; } }
function status(msg,kind="info"){
  statusEl.textContent=msg;
  statusEl.style.borderColor={info:"var(--cell-border)",ok:"var(--ok)",bad:"var(--bad)"}[kind]||"var(--cell-border)";
  statusEl.style.color={info:"var(--muted)",ok:"#2bd576",bad:"#ff8a8a"}[kind]||"var(--muted)";
}
function updateProgress(){
  const b=readBoardFromDOM();
  const filled=b.flat().filter(x=>x!==0).length;
  const given=initialBoard.flat().filter(x=>x!==0).length;
  const total=SIDE*SIDE-given;
  const current=Math.max(0,filled-given);
  const pct=total?Math.max(0,Math.min(100,Math.round((current/total)*100))):0;
  progressEl.style.width=pct+"%";
}

/* ======= Confetti ======= */
let confettiPieces=[];
function confettiResize(){ confettiCanvas.width=boardEl.clientWidth; confettiCanvas.height=boardEl.clientHeight; }
function spawnConfetti(n=180){
  const colors=["#27c93f","#ffcc00","#2f7bff","#ea3b2d","#00d8ff"];
  confettiPieces=Array.from({length:n},()=>({x:Math.random()*confettiCanvas.width,y:-10-Math.random()*40,r:2+Math.random()*4,c:colors[Math.floor(Math.random()*colors.length)],v:1+Math.random()*2.5,w:Math.random()*1.5,a:Math.random()*Math.PI*2}));
}
function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  for(const p of confettiPieces){
    p.a+=0.05;p.y+=p.v;p.x+=Math.sin(p.a)*p.w;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=p.c;ctx.fill();
  }
  confettiPieces=confettiPieces.filter(p=>p.y<confettiCanvas.height+10);
  if(confettiPieces.length) requestAnimationFrame(drawConfetti);
}
function celebrate(){ spawnConfetti(); drawConfetti(); try{winSound.currentTime=0;winSound.play();}catch{} }

/* ======= Level/Box sizing ======= */
function setSizeByLevel(level){
  SIDE=3+level;
  if(SIDE===4){BOXR=2;BOXC=2;}
  else if(SIDE===6){BOXR=2;BOXC=3;}
  else if(SIDE===8){BOXR=2;BOXC=4;}
  else if(SIDE===9){BOXR=3;BOXC=3;}
  else{BOXR=1;BOXC=1;}
}

/* ======= Sudoku Generation ======= */
function latinBase(side){ return Array.from({length:side},(_,r)=>Array.from({length:side},(_,c)=>((r+c)%side)+1)); }
function shuffle(a){const arr=[...a];for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr;}
function generateSudoku(level=1){
  let base=latinBase(SIDE).map(r=>shuffle(r));
  // محاكاة إزالة خلايا بحسب المستوى
  const board=base.map(r=>[...r]);
  const empties=Math.floor(SIDE*SIDE*(0.2+0.1*level));
  for(let i=0;i<empties;i++){
    const r=Math.floor(Math.random()*SIDE), c=Math.floor(Math.random()*SIDE);
    board[r][c]=0;
  }
  return board;
}

/* ======= DOM Rendering ======= */
function renderBoard(b){
  boardEl.innerHTML='';
  for(let r=0;r<SIDE;r++){
    for(let c=0;c<SIDE;c++){
      const val=b[r][c], inp=document.createElement("input");
      inp.type="text";inp.maxLength=1;inp.inputMode="numeric";inp.className="cell";inp.setAttribute("data-r",r);inp.setAttribute("data-c",c);inp.setAttribute("data-box",Math.floor(r/BOXR)*BOXC+Math.floor(c/BOXC));
      if(val!==0){inp.value=val; inp.setAttribute("data-editable","false"); inp.readOnly=true;}
      else{inp.setAttribute("data-editable","true");inp.addEventListener("input",e=>{e.target.value=e.target.value.replace(/[^1-9]/g,''); updateProgress();});}
      boardEl.appendChild(inp);
    }
  }
}
function readBoardFromDOM(){
  const cells=$$(".cell"); const b=Array.from({length:SIDE},()=>Array(SIDE).fill(0));
  for(const cell of cells){ const r=+cell.dataset.r, c=+cell.dataset.c; b[r][c]=parseInt(cell.value)||0; }
  return b;
}

/* ======= Actions ======= */
btnCheck.onclick=function(){
  const b=readBoardFromDOM(), flat=b.flat();
  const errs=[];
  for(let i=0;i<SIDE;i++){
    const row=new Set(), col=new Set();
    for(let j=0;j<SIDE;j++){
      if(row.has(b[i][j]))errs.push([i,j]);
      else if(b[i][j]!==0) row.add(b[i][j]);
      if(col.has(b[j][i]))errs.push([j,i]);
      else if(b[j][i]!==0) col.add(b[j][i]);
    }
  }
  $$(".cell").forEach(c=>c.classList.remove("wrong","correct"));
  errs.forEach(([r,c])=>{ const cell=$(`.cell[data-r="${r}"][data-c="${c}"]`); if(cell) cell.classList.add("wrong"); });
  if(errs.length===0){status("تم الحلّ بنجاح!",'ok'); celebrate();}
  else status("يوجد أخطاء", "bad");
};
btnReset.onclick=function(){renderBoard(initialBoard); updateProgress(); status("تم إعادة اللعب"); startTimer();}
btnNext.onclick=function(){initialBoard=generateSudoku(currentLevel); renderBoard(initialBoard); updateProgress(); status("تم تحميل المرحلة الجديدة"); startTimer();}

/* ======= Initialization ======= */
function init(){
  setSizeByLevel(currentLevel);
  levelSel.innerHTML=''; for(let i=1;i<=5;i++){const opt=document.createElement("option");opt.value=i;opt.textContent="مستوى "+i;levelSel.appendChild(opt);}
  stageSel.innerHTML=''; for(let i=1;i<=5;i++){const opt=document.createElement("option");opt.value=i;opt.textContent="مرحلة "+i;stageSel.appendChild(opt);}
  initialBoard=generateSudoku(currentLevel);
  renderBoard(initialBoard); updateProgress(); status("جاهز"); startTimer();
  confettiResize(); window.addEventListener("resize",confettiResize);
}
init();
</script>
</body>
</html>